name: Simple Working Build

on: [push]

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Create minimal working project
      run: |
        wget -q https://services.gradle.org/distributions/gradle-7.5.1-bin.zip
        unzip -q gradle-7.5.1-bin.zip
        
        # build.gradle بسيط وصحيح
        echo 'buildscript {' > build.gradle
        echo '    repositories {' >> build.gradle
        echo '        google()' >> build.gradle
        echo '        mavenCentral()' >> build.gradle
        echo '    }' >> build.gradle
        echo '    dependencies {' >> build.gradle
        echo '        classpath "com.android.tools.build:gradle:7.3.1"' >> build.gradle
        echo '    }' >> build.gradle
        echo '}' >> build.gradle
        echo '' >> build.gradle
        echo 'allprojects {' >> build.gradle
        echo '    repositories {' >> build.gradle
        echo '        google()' >> build.gradle
        echo '        mavenCentral()' >> build.gradle
        echo '    }' >> build.gradle
        echo '}' >> build.gradle

        echo 'include ":app"' > settings.gradle
        
        mkdir -p app/src/main/java/com/evozi/slowudp
        
        # app/build.gradle بسيط وصحيح
        echo 'plugins {' > app/build.gradle
        echo '    id "com.android.application"' >> app/build.gradle
        echo '}' >> app/build.gradle
        echo '' >> app/build.gradle
        echo 'android {' >> app/build.gradle
        echo '    compileSdk 33' >> app/build.gradle
        echo '    defaultConfig {' >> app/build.gradle
        echo '        applicationId "com.evozi.slowudp"' >> app/build.gradle
        echo '        minSdk 21' >> app/build.gradle
        echo '        targetSdk 33' >> app/build.gradle
        echo '    }' >> app/build.gradle
        echo '}' >> app/build.gradle
        echo '' >> app/build.gradle
        echo 'dependencies {' >> app/build.gradle
        echo '    implementation "androidx.appcompat:appcompat:1.6.1"' >> app/build.gradle
        echo '}' >> app/build.gradle

        echo '<manifest package="com.evozi.slowudp"><application><activity android:name=".MainActivity"/></application></manifest>' > app/src/main/AndroidManifest.xml
        echo 'package com.evozi.slowudp; public class MainActivity { }' > app/src/main/java/com/evozi/slowudp/MainActivity.java

    - name: Build and verify
      run: |
        ./gradle-7.5.1/bin/gradle :app:assembleDebug --stacktrace --no-daemon
        find . -name "*.apk" && echo "SUCCESS" || echo "FAILED"

    - name: Upload
      uses: actions/upload-artifact@v4
      with:
        name: results
        path: app/build/outputs/
        if-no-files-found: ignore
